ğŸ§  Node.js Event Loop

(Call Stack, Callback Queue, Microtask Queue, Phases)
â• CommonJS vs ES Modules

ğŸŒ± First: What is Node.js? (1-liner)

Node.js is a JavaScript runtime that allows JavaScript to run outside the browser, built on V8 engine.

Node is:

Single-threaded

Non-blocking

Event-driven

ğŸ‘‰ Event Loop makes this possible.

ğŸ”„ WHAT IS THE EVENT LOOP?
ğŸ”¹ Definition

The Event Loop is a mechanism that:

Continuously checks the Call Stack

Pushes asynchronous callbacks when the stack is empty

ğŸ“Œ It allows Node.js to handle multiple async operations using one thread.

ğŸ§± CORE COMPONENTS (VERY IMPORTANT)
1ï¸âƒ£ Call Stack
ğŸ”¹ What is it?

A stack data structure

Stores function calls

Follows LIFO (Last In First Out)

ğŸ”¹ Example
function a() {
  b();
}
function b() {
  console.log("Hello");
}
a();


Execution order:

a â†’ b â†’ console.log â†’ pop â†’ pop â†’ pop


ğŸ“Œ If call stack is busy â†’ Node is blocked.

2ï¸âƒ£ Callback Queue (Macrotask Queue)
ğŸ”¹ What is it?

Stores callbacks of:

setTimeout

setInterval

setImmediate

I/O callbacks

Example:

setTimeout(() => {
  console.log("Timer");
}, 0);


ğŸ“Œ Even 0 ms goes to Callback Queue, not Call Stack.

3ï¸âƒ£ Microtask Queue (HIGH PRIORITY)
ğŸ”¹ What goes here?

Promise.then

Promise.catch

queueMicrotask

process.nextTick (Node only)

ğŸ“Œ Microtasks run before callback queue

ğŸ”¥ Priority Order
Call Stack
â†“
Microtask Queue
â†“
Callback Queue

4ï¸âƒ£ Event Loop Phases (NODE SPECIFIC ğŸ”¥)

Node.js event loop has phases:

ğŸ”¹ Phases Order

Timers

setTimeout

setInterval

Pending Callbacks

Some system-level callbacks

Idle, Prepare

Internal use

Poll â­

I/O callbacks

Waits for new events

Check

setImmediate

Close Callbacks

Cleanup (socket.on('close'))

ğŸ“Œ After each phase, microtasks are executed.

ğŸ§ª CLASSIC INTERVIEW EXAMPLE
console.log("start");

setTimeout(() => console.log("timeout"), 0);

Promise.resolve().then(() => console.log("promise"));

console.log("end");

ğŸ”¹ Output
start
end
promise
timeout

ğŸ”¹ Why?

Sync â†’ call stack

Promise â†’ microtask queue

setTimeout â†’ callback queue

âš ï¸ process.nextTick (Node-only)
process.nextTick(() => console.log("nextTick"));


ğŸ“Œ Runs before promises
ğŸ“Œ Can starve event loop if abused

â• CommonJS vs ES Modules
ğŸ“¦ CommonJS (require)
ğŸ”¹ Used by default in Node.js
const fs = require("fs");

ğŸ”¹ Export
module.exports = add;

ğŸ”¹ Import
const add = require("./add");

ğŸ”¹ Features

Synchronous loading

Dynamic imports allowed

Used in older Node projects

ğŸŒ ES Modules (import/export)
ğŸ”¹ Modern JavaScript standard
import fs from "fs";

ğŸ”¹ Export
export default add;
export const sum = () => {};

ğŸ”¹ Import
import add, { sum } from "./add.js";

ğŸ”¥ Key Differences (INTERVIEW TABLE)
Feature	CommonJS	ES Modules
Syntax	require	import
Loading	Synchronous	Asynchronous
Standard	Node-specific	JavaScript standard
Top-level await	âŒ	âœ…
Browser support	âŒ	âœ…
File extension	.js	.mjs or "type":"module"
ğŸ§  When to use what?

Node-only backend â†’ CommonJS (legacy)

Modern apps / frontend + backend â†’ ES Modules

ğŸ§  One-line interview answers

Event loop enables Node.js to perform non-blocking I/O using a single thread.

Microtask queue has higher priority than callback queue.

ES Modules are the official JavaScript module system.